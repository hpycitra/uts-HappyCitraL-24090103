<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total Penjualan - Universitas Harkat Negeri</title>
    <style>
        /* CSS yang konsisten (seperti total-revenue.html sebelumnya) */
        body { font-family: Arial, sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #333; background-color: #f0f0f0; }
        .dashboard-wrapper { display: flex; width: 800px; height: 90vh; max-height: 900px; background-color: #fff; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden; }
        /* SIDEBAR */
        .sidebar { width: 100px; background-color: #f8f8f8; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; align-items: center; padding-top: 80px; height: 100%; z-index: 10; }
        .sidebar a { padding: 2px 0; text-align: center; display: flex; justify-content: center; align-items: center; text-decoration: none; width: 100%; transition: background-color 0.3s; box-sizing: border-box; }
        .sidebar a:hover { background-color: #eeeeee; }
        .sidebar .icon { width: 80px; height: 80px; filter: grayscale(100%) opacity(0.5); transition: opacity 0.3s, filter 0.3s; }
        .sidebar a:hover .icon { opacity: 1; filter: none; }
        .sidebar a.active-link { background-color: #eeeeee; padding-top: 2px; padding-bottom: 2px; border-left: 5px solid #4a4a4a; margin-left: -5px; width: calc(100% + 5px); }
        .sidebar a.active-link .icon { filter: none; opacity: 1; }
        /* MAIN CONTENT */
        .main-content { flex-grow: 1; padding: 30px; background-color: #fff; overflow-y: auto; }
        .header { margin-bottom: 30px; }
        .header h1 { font-size: 28px; font-weight: bold; color: #333; margin: 0; }
        .search-container { margin-bottom: 20px; }
        .search-container input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
        /* TABLE STYLING */
        table { width: 100%; border-collapse: collapse; margin-top: 0; border: 1px solid #ddd; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; font-size: 14px; }
        th { background: #f8f8f8; font-weight: bold; color: #555; text-transform: uppercase; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .btn { padding: 4px 8px; font-size: 12px; font-weight: 500; text-transform: uppercase; border-radius: 4px; cursor: pointer; border: none; color: white; margin: 0 2px; }
        .detail { background: #cccecf; }
        .delete { background: #cfcaca; }
        .scroll-area { max-height: calc(90vh - 180px); overflow-y: auto; }
        
        /* MODAL STYLES (Diperlukan untuk Hapus) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.35); display: none; /* Default hidden */
            justify-content: center; align-items: center; z-index: 9999;
        }
        .modal-box {
            background: white; width: 350px; padding: 22px; border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.25); text-align: center;
        }
        .modal-box button {
            padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        .cancel-btn { background: #ddd; margin-right: 5px; }
        .delete-btn { background: rgb(202, 192, 192); color:white; }
        .modal-box p { margin: 15px 0; font-size: 16px; }
    </style>
</head>
<body>

    <div class="dashboard-wrapper">
        <div class="sidebar">
            <a href="dashboard.html" title="Dashboard"> 
                <img src="assets/image/home.png" alt="Dashboard Icon" class="icon"/>
            </a>
            <a href="products.html" title="Data Produk">
                <img src="assets/image/dataproduk.png" alt="Products Icon" class="icon"/>
            </a>
            <a href="total-sales.html" class="active-link" title="Penjualan">
                <img src="assets/image/penjualan.png" alt="Sales Icon" class="icon"/>
            </a>
            <a href="laporan.html" title="Laporan"> 
                <img src="assets/image/laporan.png" alt="Reports Icon" class="icon"/>
            </a>
            <a href="pengaturan.html" title="Pengaturan">
                <img src="assets/image/pengaturan.png" alt="Settings Icon" class="icon"/>
            </a>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Data Penjualan (Total Transaksi: <span id="totalSalesHeader">85</span>)</h1> 
            </div>

            <div class="main-content-area">
                <div class="search-container">
                    <input type="text" id="search" placeholder="Cari nama produk atau tanggal...">
                </div>

                <div class="scroll-area">
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Produk</th>
                                <th>Qty</th>
                                <th>Harga Satuan</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody"></tbody> </table>
                </div>
            </div>
        </div>
    </div>
    
    <div id="deleteModal" class="modal">
        <div class="modal-box">
            <h3>Konfirmasi Hapus</h3>
            <p id="deleteText">Apakah kamu yakin ingin menghapus transaksi ini? Aksi ini tidak dapat dibatalkan.</p>
            <div style="text-align:right;">
                <button class="cancel-btn" onclick="closeDelete()">Batal</button>
                <button class="delete-btn" onclick="confirmDelete()">Hapus</button>
            </div>
        </div>
    </div>

<script>
    const DATE_START = new Date("2025-11-01");
    const NUM_SALES = 85; 
    
    // Data Produk
    const ALL_PRODUCTS = [
        { name: "Kopi Gayo", price: 25000 },
        { name: "Teh Hitam", price: 18000 },
        { name: "Coklat Aceh", price: 30000 },
        { name: "Kopi Latte", price: 25000 },
        { name: "Es Teh Leci", price: 18000 },
        { name: "Susu Vanilla", price: 20000 },
        { name: "Ice Blend Coklat", price: 32000 },
        { name: "Jus Alpukat", price: 28000 },
    ];
    
    let salesData = []; 
    const tableBody = document.getElementById("salesTableBody"); // Menggunakan ID yang diperbarui
    let deleteId = null; // Variabel global untuk menyimpan ID yang akan dihapus

    let currentId = 1; // Untuk ID unik

    function formatRupiah(number) {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(number);
    }
    
    function generateRandomSales() {
        salesData = []; 
        for (let i = 0; i < NUM_SALES; i++) {
            const randomProduct = ALL_PRODUCTS[Math.floor(Math.random() * ALL_PRODUCTS.length)];
            const qty = Math.floor(Math.random() * 5) + 1; 
            
            const date = new Date(DATE_START);
            date.setDate(DATE_START.getDate() + Math.floor(Math.random() * 15));
            const dateString = date.toISOString().split('T')[0];

            salesData.push({
                id: currentId++, // Menambahkan ID unik
                product: randomProduct.name,
                qty: qty,
                price: randomProduct.price,
                total: qty * randomProduct.price,
                date: dateString
            });
        }
    }

    function updateHeaderCount() {
        document.getElementById("totalSalesHeader").innerText = salesData.length;
    }

    function renderSalesTable(data = salesData) {
        tableBody.innerHTML = "";
        let counter = 1;

        data.forEach(s => {
            let row = tableBody.insertRow();
            
            row.innerHTML = `
                <td>${counter++}</td>
                <td>${s.date}</td>
                <td>${s.product}</td>
                <td>${s.qty}</td>
                <td>${formatRupiah(s.price)}</td>
                <td>${formatRupiah(s.total)}</td>
                <td>
                    <button class="btn detail">Detail</button>
                    <button class="btn delete" onclick="deleteSale(${s.id})">Hapus</button>
                </td>
            `;
        });
        updateHeaderCount(); // Update hitungan setiap kali render
    }

    /* =============== DELETE MODAL HANDLERS (FUNGSI BARU) =============== */

    window.deleteSale = function(id) {
        deleteId = id;
        const s = salesData.find(x => x.id === id);

        document.getElementById("deleteText").textContent =
            `Apakah kamu yakin ingin menghapus transaksi produk "${s.product}" tanggal ${s.date}? Aksi ini tidak dapat dibatalkan.`;

        document.getElementById("deleteModal").style.display = "flex";
    }

    window.closeDelete = function() {
        document.getElementById("deleteModal").style.display = "none";
    }

    window.confirmDelete = function() {
        salesData = salesData.filter(s => s.id !== deleteId);
        closeDelete();
        renderSalesTable(); // Render ulang tabel setelah penghapusan
        alert("Transaksi berhasil dihapus!");
    }

    // Fungsi pencarian
    document.getElementById("search").addEventListener("keyup", function() {
        let keyword = this.value.toLowerCase();
        
        const filteredSales = salesData.filter(s => {
            const text = `${s.date} ${s.product}`.toLowerCase();
            return text.includes(keyword);
        });
        
        renderSalesTable(filteredSales);
    });

    // Inisialisasi
    generateRandomSales();
    renderSalesTable();
</script>

</body>
</html>